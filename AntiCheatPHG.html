<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="icon" href="https://i.postimg.cc/3NZ70b7T/Logo-Wisp3.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Cheat PHG | Shadow Born</title>
    
    <!-- Open Graph метатеги для корректного отображения в соцсетях -->
    <meta property="og:title" content="Anti-Cheat PHG  - Dead by Daylight">
    <meta property="og:description" content="PHG | DBD Creator">
    <meta property="og:image" content="https://i.postimg.cc/GtKwypHr/shadow-Born.png">
    <meta property="og:url" content="https://mcpleh.github.io/PHGBALANCEDBD/AntiCheatPHG.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Anti-Cheat | Shadow Born">
    
    <!-- Дополнительные метатеги для ВКонтакте -->
    <meta property="vk:image" content="https://i.postimg.cc/GtKwypHr/shadow-Born.png">
    
    <!-- Дополнительные метатеги для Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Anti-Cheat PHG  - Dead by Daylight">
    <meta name="twitter:description" content="PHG | DBD Creator">
    <meta name="twitter:image" content="https://i.postimg.cc/GtKwypHr/shadow-Born.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff0000, #ff3333, #ff6666);
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            margin-right: 20px;
            overflow: hidden;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .logo-text {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(90deg, #ff3333, #ff6666);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 100, 100, 0.5);
        }
        
        .tagline {
            font-size: 18px;
            color: #b0b0b0;
            margin-top: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(20, 20, 20, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid #444;
        }
        
        .panel h2 {
            color: #ddd;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
        }
        
        .panel h2 i {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .status-item {
            background: rgba(30, 30, 30, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #555;
            transition: all 0.3s ease;
        }
        
        .status-item.safe {
            border-left-color: #4CAF50;
        }
        
        .status-item.warning {
            border-left-color: #FFC107;
        }
        
        .status-item.danger {
            border-left-color: #F44336;
        }
        
        .status-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .status-title {
            font-size: 14px;
            color: #b0b0b0;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #2E7D32, #4CAF50);
            color: white;
            flex: 2;
        }
        
        .btn-primary:disabled {
            background: linear-gradient(90deg, #666, #999);
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: rgba(60, 60, 60, 0.8);
            color: #b0b0b0;
            border: 1px solid #666;
            flex: 1;
        }
        
        .btn-contact {
            background: linear-gradient(90deg, #b71c1c, #f44336);
            color: white;
            flex: 1;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(15, 15, 15, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #aaa;
            font-weight: bold;
            min-width: 80px;
        }
        
        .log-message {
            margin-left: 15px;
        }
        
        .log-warning {
            color: #FFC107;
        }
        
        .log-danger {
            color: #F44336;
        }
        
        .log-safe {
            color: #4CAF50;
        }
        
        .log-file {
            color: #66b3ff;
            font-family: monospace;
            font-size: 12px;
        }
        
        .result-box {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.5s ease;
        }
        
        .result-safe {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            color: #4CAF50;
        }
        
        .result-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #FFC107;
            color: #FFC107;
        }
        
        .result-danger {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #F44336;
            color: #F44336;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #888;
            font-size: 14px;
            border-top: 1px solid #444;
            width: 100%;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }
        
        .scanning {
            animation: scanning 1.5s infinite;
        }
        
        @keyframes scanning {
            0% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.5;
            }
        }
        
        /* Модальное окно */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(30, 0, 0, 0.9) 0%, rgba(60, 0, 0, 0.9) 100%);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            border: 2px solid #ff3333;
            text-align: center;
        }
        
        .modal h2 {
            color: #ff6666;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .modal p {
            color: #ffb3b3;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-accept {
            background: linear-gradient(90deg, #2E7D32, #4CAF50);
            color: white;
        }
        
        .modal-decline {
            background: linear-gradient(90deg, #b71c1c, #f44336);
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .scan-timer {
            text-align: center;
            margin: 10px 0;
            color: #de1d1d;
            font-weight: bold;
        }
        
        /* Модальное окно успешной проверки */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .success-content {
            background: linear-gradient(135deg, rgba(0, 30, 0, 0.9) 0%, rgba(0, 60, 0, 0.9) 100%);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.5);
            border: 2px solid #4CAF50;
            text-align: center;
        }
        
        .success-content h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .success-content p {
            color: #b3ffb3;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .success-btn {
            background: linear-gradient(90deg, #2E7D32, #4CAF50);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Модальное окно обнаружения угрозы */
        .danger-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .danger-content {
            background: linear-gradient(135deg, rgba(60, 0, 0, 0.9) 0%, rgba(90, 0, 0, 0.9) 100%);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
            border: 2px solid #ff0000;
            text-align: center;
        }
        
        .danger-content h2 {
            color: #ff3333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .danger-content p {
            color: #ff9999;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .danger-btn {
            background: linear-gradient(90deg, #b71c1c, #f44336);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .note {
            font-size: 14px;
            color: #ffcccc;
            margin-top: 15px;
            font-style: italic;
        }
        
        /* Новые стили для формы */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ffb3b3;
            font-weight: bold;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ff6666;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #ff3333;
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.5);
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-top: 20px;
        }
        
        .checkbox {
            margin-right: 10px;
            margin-top: 3px;
        }
        
        .checkbox-label {
            color: #ffb3b3;
            font-size: 14px;
            text-align: left;
        }
        
        .checkbox-label a {
            color: #ff9999;
            text-decoration: underline;
        }
        
        .user-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 4px solid #ff6666;
        }
        
        .user-info p {
            margin: 5px 0;
            color: #ffb3b3;
        }
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        /* Стили для сообщения о мобильном устройстве */
        .mobile-warning {
            display: none;
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            border-radius: 15px;
            margin: 50px auto;
            border: 3px solid #ff3333;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
            max-width: 500px;
            width: 90%;
        }
        
        .mobile-warning h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .mobile-warning p {
            color: #ffcccc;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .mobile-icon {
            font-size: 64px;
            margin-bottom: 20px;
            display: block;
        }

        /* Скрытие основного контента на мобильных устройствах */
        .desktop-only {
            display: block;
        }

        @media (max-width: 768px) {
            .desktop-only {
                display: none !important;
            }
            
            .mobile-warning {
                display: block;
            }
        }
    </style>
</head>
<body>

<!-- Сообщение для мобильных устройств -->
<div id="mobileWarning" class="mobile-warning">
    <div class="mobile-icon">📱</div>
    <h2>Доступ только с компьютера</h2>
    <p>Анти-чит система Shadow Born работает только на компьютерах под управлением Windows.</p>
    <p>Пожалуйста, откройте эту страницу на вашем ПК для проведения проверки системы.</p>
    <p style="margin-top: 20px; font-size: 14px; color: #ffaaaa;">
        Для игры Dead by Daylight требуется доступ к системным файлам и процессам, 
        который недоступен на мобильных устройствах.
    </p>
</div>

<!-- Основной контент (только для ПК) -->
<div id="mainContent" class="desktop-only">
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://i.postimg.cc/GtKwypHr/shadow-Born.png" alt="Shadow Born Logo">
                </div>
                <div class="logo-text">SHADOW BORN</div>
            </div>
            <center><p class="tagline">Анти-чит система Shadow Born для Dead by Daylight. Мониторинг подозрительной активности файлов игры без их изменения.</p></center>
        </div>
        
        <div class="dashboard">
            <div class="panel">
                <h2><i>📊</i> Статус системы</h2>
                <div class="status-grid">
                    <div class="status-item" id="systemStatus">
                        <div class="status-title">СТАТУС СИСТЕМЫ</div>
                        <div class="status-value">Готов</div>
                    </div>
                    <div class="status-item" id="processCheck">
                        <div class="status-title">ПРОВЕРКА ПРОЦЕССОВ</div>
                        <div class="status-value">Не проверено</div>
                    </div>
                    <div class="status-item" id="networkCheck">
                        <div class="status-title">СЕТЕВАЯ АКТИВНОСТЬ</div>
                        <div class="status-value">Не проверено</div>
                    </div>
                    <div class="status-item" id="memoryCheck">
                        <div class="status-title">ЦЕЛОСТНОСТЬ ПАМЯТИ</div>
                        <div class="status-value">Не проверено</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="scanBtn" class="btn btn-primary pulse">
                        <i>🔍</i> Начать проверку
                    </button>
                    <button id="stopBtn" class="btn btn-secondary" disabled>
                        <i>⏹️</i> Остановить
                    </button>
                    <button id="contactAdminBtn" class="btn btn-contact" style="display: none;">
                        <i>📞</i> Связаться с администрацией
                    </button>
                </div>
            </div>
            
            <div class="panel">
                <h2><i>📝</i> Журнал проверки</h2>
                <div class="scan-timer" id="scanTimer" style="display: none;">
                    Не выключайте эту страницу браузера </br>
                    Осталось время проверки: <span id="timeLeft">60</span> сек
                </div>
                <div class="log-container" id="log">
                    <div class="log-entry">
                        <span class="log-time">00:00:00</span>
                        <span class="log-message">Система инициализирована и готова к проверке.</span>
                    </div>
                </div>
                
                <div id="result" class="result-box result-safe">
                    Система готова к проверке
                </div>
            </div>
        </div>
        
        <div class="footer">
            <center><a href="mainPHG.html" class="btn" style="background-color: #4a4a4a;"><i class="fa fa-microchip"></i> Назад на сайт PHG Balance</a></center>
            <p>Shadow Born Anti-Cheat v1.2 | Это средство работает локально и не изменяет файлы игры Dead by Daylight только сканирует их.</p>
            <center><p>Сайт создан при поддержке by PHG community</p></center>
        </div>
    </div>

    <!-- Модальное окно разрешения -->
    <div id="permissionModal" class="modal">
        <div class="modal-content">
            <h2>🔐 Запрос разрешения</h2>
            <p>Анти-чит системе Shadow Born требуется разрешение на проверку файлов вашего компьютера и системных процессов для обнаружения потенциальных угроз и запрещеного ПО.</p>
            <p>Проверка будет включать анализ:</p>
            <ul style="text-align: left; color: #ffb3b3; margin: 15px 0;">
                <li>Системных процессов</li>
                <li>Сетевой активности</li>
                <li>Целостности памяти</li>
                <li>Файлов игры</li>
            </ul>
            
            <div class="form-group">
                <label class="form-label" for="usernameInput">Введите ваш ник:</label>
                <input type="text" id="usernameInput" class="form-input" placeholder="Например: SurvivorMain123" required>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="agreeCheckbox" class="checkbox">
                <label for="agreeCheckbox" class="checkbox-label">
                    Я согласен с условиями использования анти-чит системы и подтверждаю, что не использую запрещенное ПО.
                </label>
            </div>
            </br>
            <div class="modal-buttons">
                <button id="acceptBtn" class="modal-btn modal-accept" disabled>Разрешить</button>
                <button id="declineBtn" class="modal-btn modal-decline">Отклонить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно уведомления о разрешении -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <h2>🔐 Запрос разрешения браузера</h2>
            <p>Пожалуйста, разрешите доступ к файловой системе в появившемся окне браузера для продолжения проверки.</p>
            <p>Это необходимо для сканирования системных файлов и процессов на наличие запрещеного ПО на вашем компьютере.</p>
            <div class="user-info">
                <p><strong>Пользователь:</strong> <span id="userDisplayName">Не указан</span></p>
                <p><strong>Статус:</strong> Нажмите продолжить...</p>
            </div>
            </br>
            <button id="continueAfterNotification" class="modal-btn modal-accept">Продолжить</button>
        </div>
    </div>

    <!-- Модальное окно успешной проверки -->
    <div id="successModal" class="success-modal">
        <div class="success-content">
            <h2>✅ Проверка завершена успешно</h2>
            <p>Система проверена и не содержит запрещеного ПО. Для игры Dead by Daylight.</p>
            <p>Все процессы и файлы соответствуют требованиям безопасности.</p>
            <div class="user-info">
                <p><strong>Пользователь:</strong> <span id="successUserName">Не указан</span></p>
                <p><strong>Статус проверки:</strong> ✅ Успешно</p>
            </div>
            </br>
            <button id="continueBtn" class="success-btn">Перейти к игре</button>
        </div>
    </div>

    <!-- Модальное окно обнаружения угрозы -->
    <div id="dangerModal" class="danger-modal">
        <div class="danger-content">
            <h2>🚨 Обнаружена угроза!</h2>
            <p>В ходе проверки системы обнаружены потенциальные угрозы безопасности или запрещеное ПО.</p>
            <p>Пожалуйста, свяжитесь с администрацией для ручной проверки вашей системы.</p>
            <div class="user-info">
                <p><strong>Пользователь:</strong> <span id="dangerUserName">Не указан</span></p>
                <p><strong>Статус проверки:</strong> 🚨 Заблокирован</p>
            </div>
            <p class="note">Примечание: Сделайте н всякий случай скриншоты ошибок и этого сообщения для диалога с поддержкой</p>
            <button id="contactBtn" class="danger-btn">Связаться с администрацией</button>
        </div>
    </div>
</div>

<script>
// Функция для определения мобильного устройства
function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
           (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) || // iPad iOS 13+
           window.innerWidth <= 768; // Дополнительная проверка по ширине экрана
}

// Проверка при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    const mobileWarning = document.getElementById('mobileWarning');
    const mainContent = document.getElementById('mainContent');
    
    // Проверка на мобильное устройство
    if (isMobileDevice()) {
        // Показываем предупреждение и скрываем основной контент
        if (mobileWarning) mobileWarning.style.display = 'block';
        if (mainContent) mainContent.style.display = 'none';
        return; // Прекращаем выполнение скрипта для мобильных устройств
    } else {
        // Скрываем предупреждение и показываем основной контент для ПК
        if (mobileWarning) mobileWarning.style.display = 'none';
        if (mainContent) mainContent.style.display = 'block';
    }

    // Остальной код для ПК...
    const scanBtn = document.getElementById('scanBtn');
    const stopBtn = document.getElementById('stopBtn');
    const contactAdminBtn = document.getElementById('contactAdminBtn');
    const log = document.getElementById('log');
    const result = document.getElementById('result');
    const systemStatus = document.getElementById('systemStatus');
    const processCheck = document.getElementById('processCheck');
    const networkCheck = document.getElementById('networkCheck');
    const memoryCheck = document.getElementById('memoryCheck');
    const permissionModal = document.getElementById('permissionModal');
    const notificationModal = document.getElementById('notificationModal');
    const successModal = document.getElementById('successModal');
    const dangerModal = document.getElementById('dangerModal');
    const acceptBtn = document.getElementById('acceptBtn');
    const declineBtn = document.getElementById('declineBtn');
    const continueBtn = document.getElementById('continueBtn');
    const contactBtn = document.getElementById('contactBtn');
    const scanTimer = document.getElementById('scanTimer');
    const timeLeftElement = document.getElementById('timeLeft');
    const usernameInput = document.getElementById('usernameInput');
    const agreeCheckbox = document.getElementById('agreeCheckbox');
    const continueAfterNotification = document.getElementById('continueAfterNotification');
    const userDisplayName = document.getElementById('userDisplayName');
    const successUserName = document.getElementById('successUserName');
    const dangerUserName = document.getElementById('dangerUserName');
    
    let scanInterval;
    let fileAnimationInterval;
    let timerInterval;
    let scanCount = 0;
    let isScanning = false;
    let timeLeft = 60;
    let threatDetected = false;
    let currentUsername = '';
    
    // База данных заблокированных ников
    const blockedUsernames = [
        'exrkGAShxw',
        'lordkappa02',
        'egorka/show',
        'egorka show',
        'Hermit',
        'Hermitjke',
        'Anoniw',
        'An0niw',
        'Anoniwjke',
        'An0niwjke',
        'Redison',
        'Redisonqwe',
        'Redisonjke',
        'Red1son',
        'REDISON',
        'PXPX',
        'Vogue',
        'Chadman',
        'CHADMAN',
        'WallHackUser',
        'AimbotPlayer',
        'UnfairAdvantage',
        'GameBreaker',
        'Exploiter',
        'ModdedClient'
    ];
    
    // Ключи для localStorage
    const STORAGE_KEYS = {
        SCAN_BLOCKED: 'shadowborn_scan_blocked',
        SYSTEM_STATUS: 'shadowborn_system_status',
        PROCESS_STATUS: 'shadowborn_process_status',
        NETWORK_STATUS: 'shadowborn_network_status',
        MEMORY_STATUS: 'shadowborn_memory_status',
        RESULT_STATUS: 'shadowborn_result_status',
        RESULT_MESSAGE: 'shadowborn_result_message',
        USERNAME: 'shadowborn_username'
    };
    
    // Расширенный список файлов и процессов для проверки
            const fileNames = [
    "Windows/System32/ntoskrnl.exe",
    "Windows/System32/smss.exe",
    "Windows/System32/csrss.exe",
    "Windows/System32/winlogon.exe",
    "Windows/System32/services.exe",
    "Windows/System32/lsass.exe",
    "Windows/System32/svchost.exe",
    "Windows/System32/explorer.exe",
    
    // Dead by Daylight исполняемые файлы
    "Program Files/Dead by Daylight/DeadByDaylight.exe",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/DeadByDaylight-Win64-Shipping.exe",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/DeadByDaylight-Win64-Shipping_BE.exe",
    "Program Files/Dead by Daylight/EasyAntiCheat/EasyAntiCheat.exe",
    "Program Files/Dead by Daylight/BattleEye/BEService.exe",
    "Program Files/Dead by Daylight/Binaries/Win64/DeadByDaylight-Launcher.exe",
    
    // BAT файлы (скрипты запуска и конфигурации)
    "Program Files/Dead by Daylight/LaunchGame.bat",
    "Program Files/Dead by Daylight/StartWithAntiCheat.bat",
    "Program Files/Dead by Daylight/VerifyFiles.bat",
    "Program Files/Dead by Daylight/RepairInstallation.bat",
    "Program Files/Dead by Daylight/CleanCache.bat",
    "Program Files/Steam/steamapps/common/Dead by Daylight/Start_DBD.bat",
    "Users/AppData/Local/DeadByDaylight/ConfigBackup.bat",
    "Program Files/Dead by Daylight/EasyAntiCheat/Setup.bat",
    "Program Files/Dead by Daylight/BattleEye/Install.bat",
    
    // DLL файлы (библиотеки игры и системы)
    "Windows/System32/dxgi.dll",
    "Windows/System32/d3d11.dll",
    "Windows/System32/d3d12.dll",
    "Windows/System32/opengl32.dll",
    "Windows/System32/nvcuda.dll",
    "Windows/System32/amdvlk64.dll",
    "Windows/System32/winhttp.dll",
    "Windows/System32/ws2_32.dll",
    "Windows/System32/crypt32.dll",
    "Windows/System32/bcrypt.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/D3D12Core.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/D3D11Core.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/OpenGLDrv.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/VulkanRHI.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/AudioMixer.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/NetworkReplayStreaming.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/PakFileUtilities.dll",
    "Program Files/Dead by Daylight/Engine/Binaries/Win64/UnrealCEFSubProcess.exe",
    "Program Files/Dead by Daylight/EasyAntiCheat/EasyAntiCheat_x64.dll",
    "Program Files/Dead by Daylight/BattleEye/BEClient_x64.dll",
    "Program Files/Dead by Daylight/steam_api64.dll",
    "Program Files/Dead by Daylight/EOSSDK-Win64-Shipping.dll",
    "Program Files/Dead by Daylight/PhysX3_x64.dll",
    "Program Files/Dead by Daylight/APEXFramework_x64.dll",
    
    // PAK файлы (архивы с контентом игры)
    "Program Files/Dead by Daylight/Content/Paks/pakchunk0-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk1-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk2-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk3-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk4-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk5-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk6-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk7-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk8-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk9-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk10-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk11-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk12-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk13-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk14-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk15-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk16-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk17-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk18-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk19-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk20-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk21-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk22-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk23-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk24-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk25-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk26-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk27-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk28-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk29-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk30-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk31-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk32-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk33-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk34-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk35-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk36-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk37-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk38-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk39-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk40-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk41-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk42-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk43-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk44-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk45-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk46-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk47-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk48-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk49-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk50-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk51-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk52-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk53-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk54-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk55-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk56-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk57-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk58-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk59-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk60-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk61-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk62-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk63-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk64-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk65-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk66-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk67-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk68-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk69-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk70-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk71-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk72-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk73-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk74-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk75-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk76-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk77-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk78-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk79-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk80-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk81-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk82-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk83-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk84-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk85-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk86-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk87-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk88-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk89-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk90-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk91-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk92-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk93-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk94-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk95-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk96-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk97-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk98-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk99-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk100-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional1-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional2-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional3-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional4-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional5-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional6-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional7-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional8-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional9-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-optional10-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s0-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s1-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s2-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s3-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s4-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s5-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s6-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s7-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s8-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s9-WindowsNoEditor.pak",
    "Program Files/Dead by Daylight/Content/Paks/pakchunk-s10-WindowsNoEditor.pak",
    
    // Конфигурационные файлы
    "Users/AppData/Local/DeadByDaylight/Saved/Config/WindowsNoEditor/Game.ini",
    "Users/AppData/Local/DeadByDaylight/Saved/Config/WindowsNoEditor/Engine.ini",
    "Users/AppData/Local/DeadByDaylight/Saved/Config/WindowsNoEditor/Input.ini",
    "Users/AppData/Local/DeadByDaylight/Saved/Config/WindowsNoEditor/GameUserSettings.ini",
    "Users/AppData/Local/DeadByDaylight/Saved/Config/WindowsNoEditor/Scalability.ini",
    "Users/AppData/Local/DeadByDaylight/Saved/Logs/DeadByDaylight.log",
    
    // Платформенные файлы
    "Program Files/Steam/steam.exe",
    "Program Files/Steam/steamservice.exe",
    "Program Files/Epic Games/Launcher/Portal/Binaries/Win32/EpicGamesLauncher.exe",
    "Program Files/Epic Games/Launcher/Engine/Binaries/Win64/EpicWebHelper.exe"
];

    // Функции для работы с localStorage
    function saveToStorage(key, value) {
        try {
            localStorage.setItem(key, value);
        } catch (e) {
            console.error('Ошибка сохранения в localStorage:', e);
        }
    }
    
    function getFromStorage(key, defaultValue = '') {
        try {
            return localStorage.getItem(key) || defaultValue;
        } catch (e) {
            console.error('Ошибка чтения из localStorage:', e);
            return defaultValue;
        }
    }
    
    function removeFromStorage(key) {
        try {
            localStorage.removeItem(key);
        } catch (e) {
            console.error('Ошибка удаления из localStorage:', e);
        }
    }
    
    // Проверка, является ли ник заблокированным
    function isUsernameBlocked(username) {
        return blockedUsernames.some(blocked => 
            username.toLowerCase().includes(blocked.toLowerCase())
        );
    }
    
    // Загрузка сохраненного состояния при запуске
    function loadSavedState() {
        const isScanBlocked = getFromStorage(STORAGE_KEYS.SCAN_BLOCKED, 'false') === 'true';
        
        if (isScanBlocked) {
            blockScanButton();
            contactAdminBtn.style.display = 'flex';
        }
        
        // Загрузка сохраненных статусов
        const savedSystemStatus = getFromStorage(STORAGE_KEYS.SYSTEM_STATUS);
        const savedProcessStatus = getFromStorage(STORAGE_KEYS.PROCESS_STATUS);
        const savedNetworkStatus = getFromStorage(STORAGE_KEYS.NETWORK_STATUS);
        const savedMemoryStatus = getFromStorage(STORAGE_KEYS.MEMORY_STATUS);
        const savedResultStatus = getFromStorage(STORAGE_KEYS.RESULT_STATUS);
        const savedResultMessage = getFromStorage(STORAGE_KEYS.RESULT_MESSAGE);
        const savedUsername = getFromStorage(STORAGE_KEYS.USERNAME);
        
        if (savedSystemStatus) {
            updateStatus(systemStatus, savedSystemStatus, getFromStorage(STORAGE_KEYS.SYSTEM_STATUS + '_msg', 'Готов'));
        }
        if (savedProcessStatus) {
            updateStatus(processCheck, savedProcessStatus, getFromStorage(STORAGE_KEYS.PROCESS_STATUS + '_msg', 'Не проверено'));
        }
        if (savedNetworkStatus) {
            updateStatus(networkCheck, savedNetworkStatus, getFromStorage(STORAGE_KEYS.NETWORK_STATUS + '_msg', 'Не проверено'));
        }
        if (savedMemoryStatus) {
            updateStatus(memoryCheck, savedMemoryStatus, getFromStorage(STORAGE_KEYS.MEMORY_STATUS + '_msg', 'Не проверено'));
        }
        if (savedResultStatus && savedResultMessage) {
            updateResult(savedResultStatus, savedResultMessage);
        }
        if (savedUsername) {
            usernameInput.value = savedUsername;
            currentUsername = savedUsername;
        }
    }
    
    // Сохранение статусов
    function saveStatus(elementId, status, message) {
        const key = `shadowborn_${elementId.toLowerCase()}`;
        saveToStorage(key, status);
        saveToStorage(key + '_msg', message);
    }
    
    function addLogEntry(message, type = '', isFile = false) {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        
        const time = document.createElement('span');
        time.className = 'log-time';
        time.textContent = new Date().toLocaleTimeString();
        
        const msg = document.createElement('span');
        if (isFile) {
            msg.className = `log-message log-file`;
        } else {
            msg.className = `log-message ${type}`;
        }
        msg.textContent = message;
        
        entry.appendChild(time);
        entry.appendChild(msg);
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    }
    
    function updateStatus(element, status, message) {
        element.querySelector('.status-value').textContent = message;
        element.className = `status-item ${status}`;
        
        // Сохранение статуса в localStorage
        const elementId = element.id;
        saveStatus(elementId, status, message);
    }
    
    function updateResult(status, message) {
        result.textContent = message;
        result.className = `result-box result-${status}`;
        
        // Сохранение результата
        saveToStorage(STORAGE_KEYS.RESULT_STATUS, status);
        saveToStorage(STORAGE_KEYS.RESULT_MESSAGE, message);
    }
    
    function resetStatuses() {
        updateStatus(processCheck, '', 'Не проверено');
        updateStatus(networkCheck, '', 'Не проверено');
        updateStatus(memoryCheck, '', 'Не проверено');
        updateStatus(systemStatus, '', 'Готов');
        updateResult('safe', 'Система готова к проверке');
        
        // Очистка сохраненных статусов
        removeFromStorage(STORAGE_KEYS.SYSTEM_STATUS);
        removeFromStorage(STORAGE_KEYS.PROCESS_STATUS);
        removeFromStorage(STORAGE_KEYS.NETWORK_STATUS);
        removeFromStorage(STORAGE_KEYS.MEMORY_STATUS);
        removeFromStorage(STORAGE_KEYS.RESULT_STATUS);
        removeFromStorage(STORAGE_KEYS.RESULT_MESSAGE);
    }
    
    function performFinalCheck() {
        addLogEntry('Завершение проверки системы...', 'log-safe');
        updateStatus(systemStatus, 'warning', 'Завершение проверки...');
        
        // Проверяем, не заблокирован ли пользователь
        if (isUsernameBlocked(currentUsername)) {
            // Пользователь в черном списке - всегда показываем угрозу
            updateResult('danger', 'Обнаружено запрещеное ПО');
            updateStatus(systemStatus, 'safe', 'Проверено');
            updateStatus(processCheck, 'safe', 'Проверено');
            updateStatus(networkCheck, 'safe', 'Проверено');
            updateStatus(memoryCheck, 'safe', 'Проверено');
            blockScanButton(); // Блокируем кнопку при обнаружении угрозы
            addLogEntry('Проверка завершена: обнаружены угрозы безопасности', 'log-danger');
            addLogEntry('Пользователь находится в списке подозрительных', 'log-danger');
            contactAdminBtn.style.display = 'flex';
            threatDetected = true;
            
            // Показываем модальное окно с угрозой
            dangerUserName.textContent = currentUsername;
            dangerModal.style.display = 'flex';
        } else {
            // Обычная проверка с вероятностью 95% успеха
            const isSafe = Math.random() < 0.95;
            
            if (isSafe) {
                updateResult('safe', 'Проверка завершена. Запрещеного ПО не обнаружено.');
                updateStatus(systemStatus, 'safe', 'Проверено');
                updateStatus(processCheck, 'safe', 'Проверено');
                updateStatus(networkCheck, 'safe', 'Проверено');
                updateStatus(memoryCheck, 'safe', 'Проверено');
                addLogEntry('Проверка завершена. Запрещеного ПО не обнаружено.', 'log-safe');
                
                // Разблокируем кнопку при успешной проверке
                unblockScanButton();
                
                // Показываем модальное окно успеха
                successUserName.textContent = currentUsername;
                successModal.style.display = 'flex';
            } else {
                updateResult('danger', 'Обнаружено запрещеное ПО');
                updateStatus(systemStatus, 'safe', 'Проверено');
                updateStatus(processCheck, 'safe', 'Проверено');
                updateStatus(networkCheck, 'safe', 'Проверено');
                updateStatus(memoryCheck, 'safe', 'Проверено');
                blockScanButton(); // Блокируем кнопку при обнаружении угрозы
                addLogEntry('Проверка завершена: обнаружены угрозы безопасности', 'log-danger');
                contactAdminBtn.style.display = 'flex';
                threatDetected = true;
                
                // Показываем модальное окно с угрозой
                dangerUserName.textContent = currentUsername;
                dangerModal.style.display = 'flex';
            }
        }
        
        isScanning = false;
        scanBtn.disabled = threatDetected; // Блокируем кнопку если обнаружена угроза
        stopBtn.disabled = true;
        scanTimer.style.display = 'none';
        clearInterval(scanInterval);
        clearInterval(fileAnimationInterval);
        clearInterval(timerInterval);
    }
    
    function startFileAnimation() {
        let fileIndex = 0;
        let cycleCount = 0;
        const maxCycles = 3; // Количество циклов анимации файлов
        
        fileAnimationInterval = setInterval(() => {
            if (fileIndex < fileNames.length) {
                addLogEntry(`Проверка: ${fileNames[fileIndex]}`, '', true);
                fileIndex++;
            } else {
                // Начинаем новый цикл, если файлы закончились
                fileIndex = 0;
                cycleCount++;
                if (cycleCount >= maxCycles) {
                    // После нескольких циклов начинаем добавлять случайные файлы
                    const randomFile = fileNames[Math.floor(Math.random() * fileNames.length)];
                    addLogEntry(`Проверка: ${randomFile}`, '', true);
                }
            }
        }, 300); // Каждые 300 мс показываем новый файл
    }
    
    function startScanAnimation() {
        scanCount = 0;
        addLogEntry('Начало проверки системных файлов...', 'log-warning');
        
        // Запускаем анимацию файлов, которая будет работать до конца таймера
        startFileAnimation();
        
        scanInterval = setInterval(() => {
            const checks = [
                { element: processCheck, status: ['safe', 'warning'], messages: ['Проверка процессов...', 'Анализ запущенных процессов...', 'Проверка целостности...'] },
                { element: networkCheck, status: ['safe', 'warning'], messages: ['Мониторинг сети...', 'Анализ сетевой активности...', 'Проверка соединений...'] },
                { element: memoryCheck, status: ['safe', 'warning'], messages: ['Сканирование памяти...', 'Проверка целостности памяти...', 'Анализ использования...'] }
            ];
            
            const randomCheck = checks[Math.floor(Math.random() * checks.length)];
            const randomStatus = randomCheck.status[Math.floor(Math.random() * randomCheck.status.length)];
            const randomMessage = randomCheck.messages[Math.floor(Math.random() * randomCheck.messages.length)];
            
            updateStatus(randomCheck.element, randomStatus, randomMessage);
            
            // Одна случайная надпись из списка с вероятностью 5%
            if (Math.random() < 0.05) {
                const logMessages = [
                    'Проверка целостности файлов игры...',
                    'Проверка статуса системы...',
                    'Проверка процессов игры...',
                    'Проверка сетевой активности...',
                    'Проверка целостности памяти...'
                ];
                const randomLogMessage = logMessages[Math.floor(Math.random() * logMessages.length)];
                addLogEntry(randomLogMessage, 'log-safe');
            }
        }, 600);
        
        // Таймер обратного отсчета
        timeLeft = 60;
        timeLeftElement.textContent = timeLeft;
        scanTimer.style.display = 'block';
        
        timerInterval = setInterval(() => {
            timeLeft--;
            timeLeftElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                clearInterval(fileAnimationInterval);
                performFinalCheck();
            }
        }, 1000);
    }
    
    function blockScanButton() {
        scanBtn.disabled = true;
        scanBtn.classList.remove('pulse');
        scanBtn.innerHTML = '<i>🚫</i> Проверка заблокирована';
        saveToStorage(STORAGE_KEYS.SCAN_BLOCKED, 'true');
    }
    
    function unblockScanButton() {
        scanBtn.disabled = false;
        scanBtn.classList.add('pulse');
        scanBtn.innerHTML = '<i>🔍</i> Начать проверку';
        saveToStorage(STORAGE_KEYS.SCAN_BLOCKED, 'false');
    }
    
    // Функция для имитации браузерного запроса разрешения
    function showBrowserPermissionAlert() {
        return new Promise((resolve) => {
            // Создаем кастомный alert с стилизацией под браузер
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                color: black;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                font-family: Arial, sans-serif;
                max-width: 400px;
                text-align: center;
            `;
            
            alertBox.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #333;"> Anti-Cheat | ShadowBorn </h3>
                <p style="margin: 0 0 20px 0; color: #666;">Разрешите доступ к файлам вашего компьютера</p>
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <button id="browserBlockBtn" style="padding: 8px 16px; background: #f1f1f1; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Запретить</button>
                    <button id="browserAllowBtn" style="padding: 8px 16px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer;">Разрешить</button>
                </div>
            `;
            
            document.body.appendChild(alertBox);
            
            document.getElementById('browserAllowBtn').addEventListener('click', function() {
                document.body.removeChild(alertBox);
                resolve(true);
            });
            
            document.getElementById('browserBlockBtn').addEventListener('click', function() {
                document.body.removeChild(alertBox);
                resolve(false);
            });
        });
    }
    
    // Функция для открытия внешней страницы
    function openExternalPage(url) {
        window.open(url, '_blank');
    }
    
    // Обработчики событий
    scanBtn.addEventListener('click', function() {
        // Показываем модальное окно разрешения
        permissionModal.style.display = 'flex';
    });
    
    stopBtn.addEventListener('click', function() {
        isScanning = false;
        scanBtn.disabled = false;
        scanBtn.classList.add('pulse');
        scanBtn.innerHTML = '<i>🔍</i> Начать проверку';
        stopBtn.disabled = true;
        scanTimer.style.display = 'none';
        clearInterval(scanInterval);
        clearInterval(fileAnimationInterval);
        clearInterval(timerInterval);
        
        addLogEntry('Проверка остановлена', 'log-warning');
        updateResult('warning', 'Проверка остановлена');
        updateStatus(systemStatus, 'warning', 'Проверка остановлена');
    });
    
    contactAdminBtn.addEventListener('click', function() {
        // Открываем страницу поддержки Dead by Daylight
        openExternalPage('https://t.me/chatdbdphg');
    });
    
    // Обработчики для модальных окон
    declineBtn.addEventListener('click', function() {
        permissionModal.style.display = 'none';
        addLogEntry('Пользователь отклонил запрос разрешения', 'log-warning');
    });
    
    // Обновление состояния кнопки "Разрешить" при изменении галочки и ника
    agreeCheckbox.addEventListener('change', function() {
        acceptBtn.disabled = !(agreeCheckbox.checked && usernameInput.value.trim() !== '');
    });
    
    usernameInput.addEventListener('input', function() {
        acceptBtn.disabled = !(agreeCheckbox.checked && usernameInput.value.trim() !== '');
        currentUsername = usernameInput.value.trim();
        saveToStorage(STORAGE_KEYS.USERNAME, currentUsername);
    });
    
    acceptBtn.addEventListener('click', async function() {
        if (!agreeCheckbox.checked || usernameInput.value.trim() === '') {
            alert('Пожалуйста, введите ник и согласитесь с условиями');
            return;
        }
        
        currentUsername = usernameInput.value.trim();
        saveToStorage(STORAGE_KEYS.USERNAME, currentUsername);
        
        permissionModal.style.display = 'none';
        addLogEntry('Пользователь предоставил разрешение на проверку', 'log-safe');
        
        // Показываем уведомление о разрешении браузера
        userDisplayName.textContent = currentUsername;
        notificationModal.style.display = 'flex';
        
        // Ждем пока пользователь нажмет "Продолжить"
        continueAfterNotification.onclick = async function() {
            notificationModal.style.display = 'none';
            
            // Показываем браузерный Alert для разрешения
            const permissionGranted = await showBrowserPermissionAlert();
            
            if (permissionGranted) {
                addLogEntry('Разрешение браузера предоставлено', 'log-safe');
                addLogEntry('Запуск проверки файловой системы...', 'log-safe');
                
                // Начинаем проверку
                isScanning = true;
                scanBtn.disabled = true;
                scanBtn.classList.remove('pulse');
                scanBtn.innerHTML = '<i>🔍</i> Проверка выполняется...';
                stopBtn.disabled = false;
                contactAdminBtn.style.display = 'none';
                
                // Очищаем предыдущие логи (кроме первого)
                while (log.children.length > 1) {
                    log.removeChild(log.lastChild);
                }
                
                resetStatuses();
                addLogEntry('Запуск глубокой проверки системы...', 'log-safe');
                updateStatus(systemStatus, 'warning', 'Выполняется проверка...');
                updateResult('warning', 'Выполняется проверка системы...');
                
                startScanAnimation();
            } else {
                addLogEntry('Пользователь отклонил разрешение браузера', 'log-warning');
                updateResult('warning', 'Проверка отменена - нет разрешения браузера');
            }
        };
    });
    
    continueBtn.addEventListener('click', function() {
        successModal.style.display = 'none';
        unblockScanButton();
        contactAdminBtn.style.display = 'none';
        // Открываем страницу Dead by Daylight в Steam
        openExternalPage('https://t.me/chatdbdphg');
    });
    
    contactBtn.addEventListener('click', function() {
        dangerModal.style.display = 'none';
        contactAdminBtn.style.display = 'flex';
        // Открываем страницу поддержки Dead by Daylight
        openExternalPage('https://t.me/chatdbdphg');
    });
    
    // Загрузка сохраненного состояния при запуске
    loadSavedState();
});
</script>
</body>
</html>
